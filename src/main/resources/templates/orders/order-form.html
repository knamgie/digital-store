<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Форма заказа</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
<div class="nav-bar">
    <a sec:authorize="isAuthenticated()" th:href="@{/users/profile}" class="nav-btn">Профиль</a>
    <a sec:authorize="hasRole('ADMIN')" th:href="@{/users}" class="nav-btn">Пользователи</a>
    <a th:href="@{/products}" class="nav-btn">Товары</a>
    <a th:href="@{/categories}" class="nav-btn">Категории</a>
    <a sec:authorize="isAuthenticated()" th:href="@{/orders}" class="nav-btn">Заказы</a>
    <a th:href="@{/author}" class="nav-btn">Об авторе</a>
</div>

<div class="container" style="max-width: 600px; margin-top: 50px;">
    <h1 th:text="${title}">Форма заказа</h1>

    <div th:if="${error}" class="error-message" th:text="${error}"></div>

    <form th:object="${orderDto}" th:action="@{${action}}" method="post" class="user-form">
        <input type="hidden" th:field="*{id}">
        <input type="hidden" th:field="*{productId}">

        <div class="form-group">
            <label for="userEmail">Email пользователя:</label>
            <input type="email" id="userEmail" th:field="*{userEmail}" required
                   th:readonly="${isClient}"
                   th:style="${isClient} ? 'background-color: #f0f0f0; cursor: not-allowed;' : ''"
                   placeholder="Введите email пользователя">
        </div>

        <div class="form-group">
            <label>Товар:</label>
            <input type="text" th:value="${product.name} + ' (' + ${product.brand} + ') - ' + ${#numbers.formatDecimal(product.price, 1, 2)} + '₽'"
                   disabled class="product-info-input">
        </div>

        <div class="form-group">
            <label for="quantity">Количество:</label>
            <input type="number" id="quantity" th:field="*{quantity}" min="1" required
                   oninput="calculateTotal()" th:attr="max=${product.quantity}, data-price=${product.price}">
            <small class="stock-info">Доступно: <span th:text="${product.quantity}"></span> шт.</small>
        </div>

        <div class="form-group">
            <label for="totalPrice">Общая сумма:</label>
            <input type="text" id="totalPrice" disabled class="total-price-input">
        </div>

        <div class="form-actions">
            <button type="submit" class="action-btn save-btn">Создать заказ</button>
            <button type="button" class="action-btn cancel-btn" onclick="location.href='/products'">Отмена</button>
        </div>
    </form>
</div>

<script th:src="@{/js/app.js}"></script>
</body>
</html>