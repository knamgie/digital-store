<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Категории</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/js/app.js}"></script>
</head>

<body>
<div class="nav-bar">
    <a sec:authorize="isAuthenticated()" th:href="@{/users/profile}" class="nav-btn">Профиль</a>
    <a sec:authorize="hasRole('ADMIN')" th:href="@{/users}" class="nav-btn">Пользователи</a>
    <a th:href="@{/products}" class="nav-btn">Товары</a>
    <a th:href="@{/categories}" class="nav-btn">Категории</a>
    <a sec:authorize="isAuthenticated()" th:href="@{/orders}" class="nav-btn">Заказы</a>
    <a th:href="@{/author}" class="nav-btn">Об авторе</a>
</div>

<div class="container">
    <h1>Категории</h1>

    <div class="logout">
        <form sec:authorize="isAuthenticated()" th:action="@{/logout}" method="post">
            <button type="submit">Выйти</button>
        </form>

        <a sec:authorize="!isAuthenticated()" th:href="@{/login}" style="text-decoration: none;">
            <button type="button">Войти</button>
        </a>
    </div>

    <div class="actions-bar" sec:authorize="hasAnyRole('MANAGER', 'ADMIN')">
        <a th:href="@{/categories/create}" style="text-decoration: none;">
            <button type="button" class="create-btn">+ Добавить новую категорию</button>
        </a>
    </div>

    <div class="filter-section">
        <h2>Поиск</h2>
        <form th:action="@{/categories/search}" method="get" class="filter-form">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="name">Название</label>
                    <input type="text" id="name" name="name" placeholder="Название категории">
                </div>
                <div class="filter-actions">
                    <button type="submit">Поиск</button>
                    <a th:href="@{/categories}" style="text-decoration: none;">
                        <button type="button" class="reset-btn">Сбросить</button>
                    </a>
                </div>
            </div>
        </form>
    </div>

    <div class="table-section">
        <h2>Список категорий</h2>
        <table class="users-table">
            <thead>
            <tr>
                <th class="sortable" data-column="id">ID<span class="sort-indicator"></span></th>
                <th class="sortable" data-column="name">Название<span class="sort-indicator"></span></th>
                <th>Описание</th>
                <th sec:authorize="hasAnyRole('MANAGER', 'ADMIN')">Действия</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="category : ${categories}">
                <td th:text="${category.id}"></td>
                <td th:text="${category.name}"></td>
                <td th:text="${category.description ?: '-'}" class="preserve-line-breaks"></td>
                <td sec:authorize="hasAnyRole('MANAGER', 'ADMIN')">
                    <a th:href="@{/categories/{id}/edit(id=${category.id})}" style="text-decoration: none;">
                        <button type="button" class="edit-btn">Редактировать</button>
                    </a>

                    <form th:action="@{/categories/{id}/delete(id=${category.id})}"
                          method="post"
                          style="display:inline;"
                          onsubmit="return confirm('Удалить категорию?');">
                        <button type="submit" class="delete-btn">Удалить</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>